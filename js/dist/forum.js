(()=>{var t={n:o=>{var s=o&&o.__esModule?()=>o.default:()=>o;return t.d(s,{a:s}),s},d:(o,s)=>{for(var e in s)t.o(s,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:s[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const s=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/app"];var n=t.n(e);const r=flarum.core.compat["common/components/Button"];var a=t.n(r);const i=flarum.core.compat["common/components/Badge"];var c=t.n(i);const u=flarum.core.compat["forum/components/Post"];var l=t.n(u);const d=flarum.core.compat["forum/components/CommentPost"];var p=t.n(d);const f=flarum.core.compat["forum/components/DiscussionPage"];var v=t.n(f);const h=flarum.core.compat["forum/utils/PostControls"];var y=t.n(h);const g=flarum.core.compat["common/helpers/icon"];var b=t.n(g);const _=flarum.core.compat["common/models/Discussion"];var P=t.n(_);const w=flarum.core.compat["common/Model"];var M=t.n(w);const D=flarum.core.compat["common/utils/Stream"];var T=t.n(D),N=function(){function t(){this.selectedPostsToMove=void 0,this.selectedPostsToMove=T()([])}var o=t.prototype;return o.push=function(t){this.selectedPostsToMove([].concat(this.selectedPostsToMove(),[t]))},o.remove=function(t){this.selectedPostsToMove(this.selectedPostsToMove().filter((function(o){return o!==t})))},o.has=function(t){return this.selectedPostsToMove().includes(t)},t}();function x(t,o){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},x(t,o)}function I(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,x(t,o)}const k=flarum.core.compat["common/components/Modal"];var F=t.n(k);const S=flarum.core.compat["common/components/Switch"];var O=t.n(S);const L=flarum.core.compat["uikit/forum/DiscussionSearch"];var j=t.n(L);const B=flarum.core.compat["forum/states/GlobalSearchState"];var C=t.n(B),A=function(t){function o(){for(var o,s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];return(o=t.call.apply(t,[this].concat(e))||this).isLoading=!1,o.newDiscussion=!1,o.newDiscussionTitle="",o.targetDiscussionId=null,o.search=new(C()),o}I(o,t);var s=o.prototype;return s.className=function(){return"MovePostsModal"},s.title=function(){return n().translator.trans("sycho-move-posts.forum.modal.title")},s.content=function(){var t=this;return m("div",{className:"Modal-body"},m("form",{className:"Form",onsubmit:this.onsubmit.bind(this)},m("div",{className:"Form-group"},m("label",null,n().translator.trans("sycho-move-posts.forum.modal.selected_posts",{count:this.attrs.postIds.length})),m("input",{className:"FormControl",readonly:!0,value:this.attrs.postIds.join(", ")})),m("div",{className:"Form-group"},m(O(),{state:this.newDiscussion,onchange:function(){return t.newDiscussion=!t.newDiscussion}},n().translator.trans("sycho-move-posts.forum.modal.new_discussion"))),this.newDiscussion?m("div",{className:"Form-group"},m("label",{for:"discussion_name"},n().translator.trans("sycho-move-posts.forum.modal.discussion_name")),m("p",{className:"helptext"},n().translator.trans("sycho-move-posts.forum.modal.discussion_help")),m("input",{id:"discussion_name",className:"FormControl",required:!0,oninput:function(o){return t.newDiscussionTitle=o.target.value}})):m("div",{className:"Form-group"},m("label",{for:"destination"},n().translator.trans("sycho-move-posts.forum.modal.destination")),m(j(),{state:this.search,ignore:this.attrs.discussion.id(),onSelect:function(o){return t.targetDiscussionId=o.id()}})),m("div",{className:"Form-group Form-controls"},m(a(),{className:"Button Button--primary",type:"submit",loading:"submit"===this.isLoading,disabled:"check"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},n().translator.trans("sycho-move-posts.forum.modal.submit")),m(a(),{className:"Button",onclick:this.emulate.bind(this),loading:"check"===this.isLoading,disabled:"submit"===this.isLoading||!this.targetDiscussionId&&!this.newDiscussionTitle},n().translator.trans("sycho-move-posts.forum.modal.check")))))},s.data=function(){var t={sourceDiscussionId:this.attrs.discussion.id(),postIds:this.attrs.postIds};return this.newDiscussion?(t.newDiscussion=!0,t.newDiscussionTitle=this.newDiscussionTitle):t.targetDiscussionId=this.targetDiscussionId,t},s.emulate=function(){var t=this;this.onsubmit(null,!0).then((function(o){switch(o.data.attributes.status){case"old_to_new_move":t.alertAttrs={type:"error",content:n().translator.trans("sycho-move-posts.forum.modal.status.old_to_new_move")};break;case"simple_move":t.alertAttrs={type:"success",content:n().translator.trans("sycho-move-posts.forum.modal.status.simple_move")};break;case"complex_move":t.alertAttrs={type:"warning",content:n().translator.trans("sycho-move-posts.forum.modal.status.complex_move")}}m.redraw()}))},s.onsubmit=function(t,o){var s=this;t&&t.preventDefault(),this.isLoading=o?"check":"submit";var e="/api/posts/move";return o&&(e+="/check"),n().request({method:"POST",url:""+n().forum.attribute("baseUrl")+e,body:{data:this.data()},errorHandler:function(t){var o=t.response.errors[0];if(s.isLoading=!1,"move_old_post_to_newer_discussion"!==o.code)throw t;s.alertAttrs={type:"error",content:n().translator.trans("sycho-move-posts.forum.error.move_old_post_to_newer_discussion")},m.redraw()}}).then((function(t){return s.isLoading=!1,o||(m.redraw(),window.location.reload(),n().modal.close()),t}))},o}(F());const q=flarum.core.compat["forum/components/EventPost"];var E=t.n(q);const z=flarum.core.compat["common/components/Link"];var G=t.n(z),H=function(t){function o(){return t.apply(this,arguments)||this}I(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.descriptionKey=function(){return"sycho-move-posts.forum.post_stream.post_moved"},s.descriptionData=function(){var t=this.attrs.post.content();return{target_discussion:m(G(),{className:"EventPost-PostMoved-target",href:app.route("discussion.near",{id:t.targetDiscussionId,near:t.number})},t.targetDiscussionTitle),count:t.count}},o}(E());const K=flarum.core.compat["forum/components/Notification"];var U=function(t){function o(){return t.apply(this,arguments)||this}I(o,t);var s=o.prototype;return s.icon=function(){return"fas fa-exchange-alt"},s.href=function(){return app.route("discussion",{id:this.attrs.notification.content().targetDiscussionId})},s.content=function(){return app.translator.trans("sycho-move-posts.forum.notifications.post_moved_text",{targetDiscussionTitle:m("span",{className:"MovePosts-Notification-targetDiscussion"},this.attrs.notification.content().targetDiscussionTitle)})},o}(t.n(K)());n().initializers.add("sycho/flarum-move-posts",(function(){if(P().prototype.isFirstMoved=M().attribute("isFirstMoved"),(0,s.extend)(P().prototype,"badges",(function(t){this.isFirstMoved()&&t.add("firstMoved",m(c(),{type:"firstPostMoved",label:n().translator.trans("sycho-move-posts.forum.badge.first_moved_tooltip"),icon:"fas fa-exchange-alt"}),-20)})),n().postComponents.postMoved=H,n().notificationComponents.postMoved=U,n().data.resources[0].attributes.canMovePosts){var t=new N;(0,s.extend)(p().prototype,"oninit",(function(){this.subtree.check((function(){return t.selectedPostsToMove()}))})),(0,s.extend)(l().prototype,"classes",(function(o){"comment"===this.attrs.post.contentType()&&t.has(this.attrs.post.id())&&o.push("Post--moving")})),(0,s.extend)(p().prototype,"headerItems",(function(o){t.has(this.attrs.post.id())&&o.add("moving",m("span",{className:"PostMoving"},b()("fas fa-exchange-alt")," ",n().translator.trans("sycho-move-posts.forum.post.moving")))})),(0,s.extend)(v().prototype,"oncreate",(function(){t.selectedPostsToMove([])})),(0,s.extend)(v().prototype,"sidebarItems",(function(o){var s=this;t.selectedPostsToMove().length&&o.add("movePosts",m(a(),{icon:"fas fa-exchange-alt",className:"Button",onclick:function(){return n().modal.show(A,{postIds:t.selectedPostsToMove(),discussion:s.discussion})}},n().translator.trans("sycho-move-posts.forum.discussion.move_posts"),m("span",{className:"MovePosts-Button-count"},t.selectedPostsToMove().length)))})),(0,s.extend)(y(),"moderationControls",(function(o,s){if("comment"===s.contentType()){var e=t.has(s.id())?"unmove":"move";o.add("movePost",m(a(),{icon:"fas fa-arrow-right",onclick:function(){"move"===e?t.push(s.id()):t.remove(s.id()),m.redraw()}},n().translator.trans("sycho-move-posts.forum.post."+e)))}}))}}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map